<Project>
    <PropertyGroup>
        <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
    </PropertyGroup>

    <!--
    This file contains targets which resolve various items from PackageReference.
    -->

    <PropertyGroup>
        <ResolveIkvmRuntimeAssemblyDependsOn>
            $(ResolveIkvmRuntimeAssemblyDependsOn);
            ResolvePackageReferences;
        </ResolveIkvmRuntimeAssemblyDependsOn>
    </PropertyGroup>

    <!-- Locates the IKVM.Runtime assembly from among the current references of the project. -->
    <Target Name="ResolveIkvmRuntimeAssembly" DependsOnTargets="$(ResolveIkvmRuntimeAssemblyDependsOn)">
        <ItemGroup>
            <_IkvmRuntimeAssembly Include="@(Reference)" Condition=" '%(Filename)%(Extension)' == 'IKVM.Runtime.dll' " />
        </ItemGroup>
        <PropertyGroup>
            <IkvmRuntimeAssembly>@(_IkvmRuntimeAssembly)</IkvmRuntimeAssembly>
        </PropertyGroup>
        <Error Text="Could not locate IKVM.Runtime.dll." Condition=" '$(IkvmRuntimeAssembly)' == '' " />
    </Target>

    <PropertyGroup>
        <ResolveIkvmRuntimeJNIAssemblyDependsOn>
            $(ResolveIkvmRuntimeJNIAssemblyDependsOn);
            ResolvePackageReferences;
        </ResolveIkvmRuntimeJNIAssemblyDependsOn>
    </PropertyGroup>

    <!-- Locates the IKVM.Runtime.JNI assembly from among the current references of the project. -->
    <Target Name="ResolveIkvmRuntimeJNIAssembly" DependsOnTargets="$(ResolveIkvmRuntimeJNIAssemblyDependsOn)">
        <ItemGroup>
            <_IkvmRuntimeJNIAssembly Include="@(Reference)" Condition=" '%(Filename)%(Extension)' == 'IKVM.Runtime.JNI.dll' " />
        </ItemGroup>
        <PropertyGroup>
            <IkvmRuntimeJNIAssembly>@(_IkvmRuntimeJNIAssembly)</IkvmRuntimeJNIAssembly>
        </PropertyGroup>
        <Error Text="Could not locate IKVM.Runtime.JNI.dll." Condition=" '$(IkvmRuntimeJNIAssembly)' == '' " />
    </Target>

    <PropertyGroup>
        <ResolveIkvmBaseAssemblyDependsOn>
            $(ResolveIkvmBaseAssemblyDependsOn);
            ResolvePackageReferences;
        </ResolveIkvmBaseAssemblyDependsOn>
    </PropertyGroup>

    <!-- Locates the IKVM.Java assembly from among the current references of the project. -->
    <Target Name="ResolveIkvmBaseAssembly" DependsOnTargets="$(ResolveIkvmBaseAssemblyDependsOn)">
        <ItemGroup>
            <_IkvmBaseAssembly Include="@(Reference)" Condition=" '%(Filename)%(Extension)' == 'IKVM.Java.dll' " />
        </ItemGroup>
        <PropertyGroup>
            <IkvmBaseAssembly>@(_IkvmBaseAssembly)</IkvmBaseAssembly>
        </PropertyGroup>
        <Error Text="Could not locate IKVM.Java.dll." Condition=" '$(IkvmBaseAssembly)' == '' " />
    </Target>

    <PropertyGroup>
        <ResolveIkvmReferenceAssembliesDependsOn>
            $(ResolveIkvmReferenceAssembliesDependsOn);
            ResolveIkvmRuntimeAssembly;
        </ResolveIkvmReferenceAssembliesDependsOn>
    </PropertyGroup>

    <!-- Gathers those references which are either related to the Framework itself, or IKVM. -->
    <Target Name="ResolveIkvmReferenceAssemblies" DependsOnTargets="$(ResolveIkvmReferenceAssembliesDependsOn)">
        <!-- Consult tool to get the reference assemblies for the tool framework. -->
        <!-- This is a bug. Tools should be able to use assemblies of project, not its own. -->
        <IkvmGetReferenceAssemblies ToolPath="$(IkvmCompilerToolPath)" ToolFramework="$(IkvmToolFramework)">
            <Output TaskParameter="ResolvedFrameworkReferences" ItemName="IkvmFrameworkReference" />
        </IkvmGetReferenceAssemblies>
    </Target>

</Project>
