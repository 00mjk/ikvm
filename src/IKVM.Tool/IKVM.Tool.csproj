<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <TargetFrameworks>net461;netcoreapp3.1</TargetFrameworks>
        <IncludeTools>true</IncludeTools>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="CliWrap" Version="3.4.4" />
    </ItemGroup>

    <ItemGroup Condition=" '$(IncludeTools)' == 'true' ">
        
        <PublishProjectReference Include="..\ikvm\ikvm.csproj">
            <SetTargetFramework>TargetFramework=net461</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\net461\any</PublishTargetPath>
            <PublishProperties>SelfContained=false;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        <PublishProjectReference Include="..\ikvmc\ikvmc.csproj">
            <SetTargetFramework>TargetFramework=net461</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\net461\any</PublishTargetPath>
            <PublishProperties>SelfContained=false;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        <PublishProjectReference Include="..\ikvmstub\ikvmstub.csproj">
            <SetTargetFramework>TargetFramework=net461</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\net461\any</PublishTargetPath>
            <PublishProperties>SelfContained=false;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        
        <PublishProjectReference Include="..\ikvm\ikvm.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\win7-x64</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=win7-x64;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        <PublishProjectReference Include="..\ikvmc\ikvmc.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\win7-x64</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=win7-x64;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        <PublishProjectReference Include="..\ikvmstub\ikvmstub.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\win7-x64</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=win7-x64;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        
        <PublishProjectReference Include="..\ikvm\ikvm.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\win7-x86</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=win7-x86;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        <PublishProjectReference Include="..\ikvmc\ikvmc.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\win7-x86</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=win7-x86;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        <PublishProjectReference Include="..\ikvmstub\ikvmstub.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\win7-x86</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=win7-x86;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        
        <PublishProjectReference Include="..\ikvm\ikvm.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\linux-x64</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=linux-x64;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        <PublishProjectReference Include="..\ikvmc\ikvmc.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\linux-x64</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=linux-x64;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        <PublishProjectReference Include="..\ikvmstub\ikvmstub.csproj">
            <SetTargetFramework>TargetFramework=netcoreapp3.1</SetTargetFramework>
            <PublishTargetPath>ikvm-tools\netcoreapp3.1\linux-x64</PublishTargetPath>
            <PublishProperties>SelfContained=false;RuntimeIdentifier=linux-x64;PreserveCompilationContext=true</PublishProperties>
        </PublishProjectReference>
        
    </ItemGroup>

</Project>
