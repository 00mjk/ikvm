<Project Sdk="Microsoft.Build.NoTargets/3.5.6">
    <Import Project="..\..\openjdk.props" />

    <PropertyGroup>
        <TargetFramework>netstandard2.0</TargetFramework>
        <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
        <AppendRuntimeIdentifierToOutputPath>false</AppendRuntimeIdentifierToOutputPath>
    </PropertyGroup>

    <ItemGroup>
        <ImageTarget Include="net461|win7-x64" TargetFramework="net461" RuntimeIdentifier="win7-x64" />
        <ImageTarget Include="net461|win7-x86" TargetFramework="net461" RuntimeIdentifier="win7-x86" />
        <ImageTarget Include="netcoreapp3.1|win7-x64" TargetFramework="netcoreapp3.1" RuntimeIdentifier="win7-x64" />
        <ImageTarget Include="netcoreapp3.1|win7-x86" TargetFramework="netcoreapp3.1" RuntimeIdentifier="win7-x86" />
        <ImageTarget Include="netcoreapp3.1|linux-x64" TargetFramework="netcoreapp3.1" RuntimeIdentifier="linux-x64" />
    </ItemGroup>

    <ItemGroup>
        <BinProject Include="..\java\java.csproj" />
        <BinProject Include="..\jar\jar.msbuildproj" />
        <BinProject Include="..\jarsigner\jarsigner.msbuildproj" />
        <BinProject Include="..\javac\javac.msbuildproj" />
        <BinProject Include="..\javadoc\javadoc.msbuildproj" />
        <BinProject Include="..\javah\javah.msbuildproj" />
        <BinProject Include="..\javap\javap.msbuildproj" />
        <BinProject Include="..\jdeps\jdeps.msbuildproj" />
        <BinProject Include="..\keytool\keytool.msbuildproj" />
        <BinProject Include="..\policytool\policytool.msbuildproj" />
        <BinProject Include="..\rmic\rmic.msbuildproj" />
        <BinProject Include="..\wsgen\wsgen.msbuildproj" />
        <BinProject Include="..\wsimport\wsimport.msbuildproj" />
    </ItemGroup>

    <Target Name="GetCopyToOutputDirectoryItemsByImageTarget" BeforeTargets="BeforeBuild" Inputs="@(ImageTarget)" Outputs="%(Identity)\null">
        <PropertyGroup>
            <_TargetFramework>%(ImageTarget.TargetFramework)</_TargetFramework>
            <_RuntimeIdentifier>%(ImageTarget.RuntimeIdentifier)</_RuntimeIdentifier>
        </PropertyGroup>
        <ItemGroup>
            <ContentWithTargetPath Include="..\..\LICENSE.md">
                <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
                <TargetPath>$(_TargetFramework)\$(_RuntimeIdentifier)\LICENSE.md</TargetPath>
            </ContentWithTargetPath>
            <ContentWithTargetPath Include="..\IKVM.Image\README.md">
                <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
                <TargetPath>$(_TargetFramework)\$(_RuntimeIdentifier)\README.md</TargetPath>
            </ContentWithTargetPath>
            <_ContentWithTargetPathContent Include="content\**\*" />
            <ContentWithTargetPath Include="@(_ContentWithTargetPathContent)">
                <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
                <TargetPath>$(_TargetFramework)\$(_RuntimeIdentifier)\%(RecursiveDir)%(Filename)%(Extension)</TargetPath>
            </ContentWithTargetPath>
            <OpenJdkContentItem Include="@(OpenJdkImageContent)">
                <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
                <TargetPath>$(_TargetFramework)\$(_RuntimeIdentifier)\%(ImagePath)</TargetPath>
            </OpenJdkContentItem>
            <ContentWithTargetPath Include="@(OpenJdkContentItem)" />
        </ItemGroup>
        <ItemGroup>
            <PublishProjectReference Include="@(BinProject)">
                <SetTargetFramework>TargetFramework=$(_TargetFramework)</SetTargetFramework>
                <SetRuntimeIdentifier>RuntimeIdentifier=$(_RuntimeIdentifier)</SetRuntimeIdentifier>
                <ProjectTargetPath>$(_TargetFramework)\$(_RuntimeIdentifier)\bin</ProjectTargetPath>
            </PublishProjectReference>
        </ItemGroup>
    </Target>

</Project>
